#!/usr/bin/env bash

if test ! $(which brew); then
  echo "Installing homebrew..."
  /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

echo "Updating brew..."
brew update

echo "Installing brew packages..."
brew install fish git macvim mas python3 awscli tree coreutils gradle tmux node tig
brew cask install iterm2 shiftit transmission postman java firefox atom slack mobster intellij-idea-ce visual-studio-code lastpass aws-vault

brew upgrade
brew cask upgrade --greedy

mas install 1278508951 #Trello
mas upgrade

echo "Setting up fish as the default shell..."
if ! grep -Fxq "/usr/local/bin/fish" /etc/shells; then
  echo "/usr/local/bin/fish" | sudo tee -a /etc/shells
fi

chsh -s /usr/local/bin/fish

echo "Configuring vim..."
ln -sf ~/.dotfiles/.vimrc ~/.vimrc

echo "Configuring iterm2..."
defaults write com.googlecode.iterm2.plist PrefsCustomFolder -string "~/.dotfiles"
defaults write com.googlecode.iterm2.plist LoadPrefsFromCustomFolder -bool true

echo "Linking dotfiles..."
ln -sf ~/.dotfiles/.config ~/
ln -sf ~/.dotfiles/.gitconfig ~/.gitconfig

echo "Cleaning up..."
brew cleanup
